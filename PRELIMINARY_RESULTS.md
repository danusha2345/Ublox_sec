# Предварительные итоги атаки на U-blox

## 1. Что было сделано
*   **Сбор данных:** Собрано **5612 подписей** из логов устройства.
*   **Анализ:**
    *   Обнаружен явный **Bias (смещение)** в распределении Nonce.
    *   **FFT анализ** показал сильный пик на частоте 1/256, что указывает на аномалию в старшем байте (8 бит).
    *   Найдено **22 подписи** с длиной `r` менее 185 бит (утечка >7 бит). Это теоретически достаточно для взлома.
*   **Атаки:**
    *   Запущена **Lattice Attack (HNP)** с использованием алгоритмов LLL и BKZ (до блока 60).
    *   Использовалась стратегия "Фермы" (параллельные попытки на случайных подмножествах).
    *   Использовалась стратегия "Концентрации" (атака только на топ-120 лучших подписей).

## 2. Текущий результат
❌ **Приватный ключ пока не найден.**
Несмотря на наличие явной уязвимости (Bias), математическая атака не может "замкнуть" уравнение.

## 3. Почему не получается? (Гипотезы)

Самая вероятная причина — **ошибка в модели уравнения**.
Мы решаем уравнение:
$$s = k^{-1} (z + r \cdot d) \pmod n$$
Где:
*   `r`, `s` — берем из подписи (тут ошибки быть не может).
*   `d` — искомый ключ.
*   `k` — случайное число (с bias).
*   **`z` — хэш сообщения.**

**Гипотеза №1: Мы неправильно считаем `z`.**
Сейчас мы используем алгоритм: `SHA-256` -> `XOR Folding` до 192 бит.
Если U-blox использует другой метод, то наше значение `z` неверное. А если `z` неверное, то уравнение **не имеет решения** (или решение другое), и Lattice Attack никогда не сработает, даже если Bias огромный.

Возможные варианты хэширования у U-blox:
1.  `SHA-256` усеченный до 192 бит (просто отбросить последние 8 байт, без XOR).
2.  `SHA-256` по модулю `n` (без усечения).
3.  `SHA-1` (устаревший, но возможный, 160 бит).
4.  Подписывается не payload, а весь пакет (с заголовком `B5 62...`).

**Гипотеза №2: Bias сложнее, чем мы думаем.**
Мы предполагаем, что `k` просто "маленькое" (старшие биты нули).
Но FFT показал периодичность. Возможно, `k` имеет структуру типа `00xxxx00xxxx...` или утечка идет в середине числа. Стандартный HNP плохо работает с такими "дырявыми" числами.

## 4. План действий (Что делать дальше)

Я рекомендую **проверить Гипотезу №1 (про `z`)**. Это самое дешевое и вероятное решение.

1.  **Пересчитать `z`** для всех 5612 подписей разными способами:
    *   `Truncate` (без XOR).
    *   `Modulo` (весь SHA-256).
    *   `Full Packet Hash`.
2.  Для каждого варианта запустить быструю атаку (на топ-100 подписях). Если вариант верный — ключ найдется мгновенно.

Если это не поможет, придется признать, что Bias слишком сложный для стандартной HNP атаки, или используется какая-то защита (например, добавление шума).
